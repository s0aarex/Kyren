<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kyren â€” Patch notes</title>

  <link rel="icon" href="./favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="./assets/style.css" />
</head>

<body class="bg">
  <div id="scribbles" aria-hidden="true"></div>

  <header class="topbar reveal">
    <div class="topbar__left">
      <span class="dot"></span>
      <span class="topbar__tag" id="tag">KYREN â€” UPDATES</span>
    </div>

    <nav class="topbar__right">
      <a class="pill" href="./index.html">ğŸ  <span id="homeTxt">Home</span></a>
      <a class="pill" href="./how-to-use.html">ğŸš€ <span id="howTxt">Como usar</span></a>
      <a class="pill" href="./feedback.html">ğŸ’¬ <span id="fbTxt">Feedback</span></a>
      <button class="pill" id="langToggle" type="button">ğŸŒ PT-BR â†’ EN</button>
    </nav>
  </header>

  <main class="wrap">
    <section class="hero reveal">
      <h1 class="hero__title">ğŸ§¾ <em id="title">Patch notes</em></h1>
      <p class="hero__sub" id="sub">
        HistÃ³rico de mudanÃ§as da Kyren â€” o que entrou, mudou e foi corrigido.
      </p>

      <div class="hero__cta">
        <a class="btn" href="./index.html">â¬…ï¸ <span id="backTxt">Voltar</span></a>
        <a class="btn" href="./feedback.html">ğŸ« <span id="ticketTxt">Reportar bug</span></a>
      </div>
    </section>

    <div class="divider reveal"></div>

    <section class="section reveal">
      <p class="kicker" id="k1">ATUALIZAÃ‡Ã•ES</p>

      <div id="patchList" class="grid" style="grid-template-columns:1fr;">
        <article class="card">
          <h3>â³ Carregandoâ€¦</h3>
          <p class="muted">Buscando <b>patch-notes.json</b></p>
        </article>
      </div>
    </section>

    <footer class="footer reveal">
      <p>ğŸ–¤ Kyren â€” Updates</p>
    </footer>
  </main>

  <script src="./assets/app.js"></script>
  <script>
    const lang = (localStorage.getItem("kyren_lang") || "pt-BR").startsWith("en") ? "en" : "pt";

    const dict = {
      pt: {
        tag:"KYREN â€” UPDATES",
        homeTxt:"Home", howTxt:"Como usar", fbTxt:"Feedback",
        title:"Patch notes",
        sub:"HistÃ³rico de mudanÃ§as da Kyren â€” o que entrou, mudou e foi corrigido.",
        backTxt:"Voltar", ticketTxt:"Reportar bug",
        k1:"ATUALIZAÃ‡Ã•ES"
      },
      en: {
        tag:"KYREN â€” UPDATES",
        homeTxt:"Home", howTxt:"How to use", fbTxt:"Feedback",
        title:"Patch notes",
        sub:"Kyren changelog â€” what was added, changed, and fixed.",
        backTxt:"Back", ticketTxt:"Report bug",
        k1:"UPDATES"
      }
    };

    const set = (id, txt) => { const el = document.getElementById(id); if(el) el.textContent = txt; };
    const d = dict[lang];
    Object.keys(d).forEach(k => set(k, d[k]));

    const btn = document.getElementById("langToggle");
    if(btn){
      btn.textContent = (lang === "en") ? "ğŸŒ EN â†’ PT-BR" : "ğŸŒ PT-BR â†’ EN";
      btn.onclick = () => {
        localStorage.setItem("kyren_lang", (lang === "en") ? "pt-BR" : "en");
        location.reload();
      };
    }

    function pick(field){
      if(field == null) return "";
      if(typeof field === "object") return field[lang] || field.pt || field.en || "";
      return String(field);
    }

    function list(field){
      if(field == null) return [];
      if(typeof field === "object") return field[lang] || field.pt || field.en || [];
      return Array.isArray(field) ? field : [];
    }

    async function loadPatches(){
      const host = document.getElementById("patchList");
      try{
        const res = await fetch("./patch-notes.json", { cache: "no-store" });
        const patches = await res.json();

        host.innerHTML = patches.map(p => {
          const title = pick(p.title);
          const summary = pick(p.summary);
          const highlights = list(p.highlights);

          const added = list(p.added);
          const changed = list(p.changed);
          const fixed = list(p.fixed);
          const removed = list(p.removed);

          const section = (label, arr, emoji) => arr?.length ? `
            <div style="margin-top:12px">
              <p class="kicker" style="margin-bottom:8px">${emoji} ${label}</p>
              <div class="hi">
                ${arr.slice(0,6).map(x => `<div class="hi__item">${x}</div>`).join("")}
              </div>
            </div>
          ` : "";

          return `
            <article class="card">
              <div class="row">
                <h3>ğŸš€ ${p.version} â€¢ ${title}</h3>
                <span class="muted">ğŸ—“ï¸ ${p.date}</span>
              </div>

              <p class="muted" style="margin-top:10px">${summary}</p>

              ${highlights.length ? `
                <div style="margin-top:12px">
                  <p class="kicker" style="margin-bottom:8px">âœ¨ HIGHLIGHTS</p>
                  <div class="hi">
                    ${highlights.slice(0,4).map(x => `<div class="hi__item">${x}</div>`).join("")}
                  </div>
                </div>
              ` : ""}

              ${section(lang==="en"?"Added":"Adicionado", added, "ğŸŸ¢")}
              ${section(lang==="en"?"Changed":"Mudou", changed, "ğŸŸ¡")}
              ${section(lang==="en"?"Fixed":"Corrigido", fixed, "ğŸ”§")}
              ${section(lang==="en"?"Removed":"Removido", removed, "ğŸ§¨")}

              ${p.stats ? `
                <p class="stats">
                  ğŸ“Œ +${p.stats.added ?? 0} â€¢ âœï¸ ${p.stats.updated ?? 0} â€¢ ğŸ§¼ ${p.stats.cleaned ?? 0}
                </p>
              ` : ""}
            </article>
          `;
        }).join("");
      }catch(e){
        console.error(e);
        host.innerHTML = `
          <article class="card">
            <h3>âš ï¸ ${lang==="en"?"Could not load":"NÃ£o carregou"}</h3>
            <p class="muted" style="margin-top:8px">
              ${lang==="en"?"Check if":"Checa se"} <b>patch-notes.json</b> ${lang==="en"?"exists in":"existe em"} <b>/docs</b>.
            </p>
          </article>
        `;
      }
    }

    loadPatches();
  </script>
</body>
</html>
